<ng-container *transloco="let t; scope: 'terminal-settings/general-settings-form'">
  <form *ngIf="form" [formGroup]="form" [nzLayout]="'vertical'" nz-form>
    <nz-form-item>
      <nz-form-label nzFor="language" nzRequired>{{t('terminalSettingsGeneralSettingsForm.langLabel')}}</nz-form-label>
      <nz-form-control>
        <nz-select formControlName='language'>
          <nz-option [nzLabel]="t('terminalSettingsGeneralSettingsForm.notSelectedOption')" [nzValue]="''" nzDisabled nzHide></nz-option>
          <nz-option [nzValue]="'en'" nzLabel="English"></nz-option>
          <nz-option [nzValue]="'ru'" nzLabel="Русский"></nz-option>
        </nz-select>
      </nz-form-control>
    </nz-form-item>
    <ng-container [formGroup]="asFormGroup(form.controls.designSettings)">
      <nz-form-item>
        <nz-form-label nzFor="theme" nzRequired>{{t('terminalSettingsGeneralSettingsForm.themeLabel')}}</nz-form-label>
        <nz-form-control>
          <nz-select formControlName='theme'>
            <nz-option [nzLabel]="t('terminalSettingsGeneralSettingsForm.darkThemeOption')" [nzValue]="themeTypes.dark"></nz-option>
            <nz-option [nzLabel]="t('terminalSettingsGeneralSettingsForm.lightThemeOption')" [nzValue]="themeTypes.default"></nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item *ngIf="!excludedSettings.includes('gridType')">
        <nz-form-label nzFor="gridType">{{t('terminalSettingsGeneralSettingsForm.gridTypeLabel')}}</nz-form-label>
        <nz-form-control>
          <nz-select formControlName='gridType'>
            <nz-option [nzLabel]="t('terminalSettingsGeneralSettingsForm.gridTypeFitOption')" [nzValue]="gridTypes.Fit"></nz-option>
            <nz-option [nzLabel]="t('terminalSettingsGeneralSettingsForm.gridTypeVerticalFixedOption')" [nzValue]="gridTypes.VerticalFixed"></nz-option>
            <nz-option [nzLabel]="t('terminalSettingsGeneralSettingsForm.gridTypeHorizontalFixedOption')" [nzValue]="gridTypes.HorizontalFixed"></nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>
    </ng-container>
    <nz-form-item>
      <nz-form-label nzFor="timezoneDisplayOption" nzRequired>{{t('terminalSettingsGeneralSettingsForm.timezoneLabel')}}</nz-form-label>
      <nz-form-control>
        <nz-select formControlName='timezoneDisplayOption'>
          <nz-option [nzLabel]="t('terminalSettingsGeneralSettingsForm.mskTimezoneOption')"
                     [nzValue]="timezoneDisplayOption.MskTime"></nz-option>
          <nz-option [nzLabel]="t('terminalSettingsGeneralSettingsForm.localTimezoneOption')"
                     [nzValue]="timezoneDisplayOption.LocalTime"></nz-option>
        </nz-select>
      </nz-form-control>
    </nz-form-item>
    <nz-form-item>
      <nz-form-label nzFor="tableRowHeight" nzRequired>{{t('terminalSettingsGeneralSettingsForm.tableRowHeightLabel')}}</nz-form-label>
      <nz-form-control>
        <nz-select formControlName='tableRowHeight'>
          <nz-option
            [nzLabel]="t('terminalSettingsGeneralSettingsForm.tableRowHeight.low')"
            [nzValue]="tableRowHeight.Low"
          ></nz-option>
          <nz-option
            [nzLabel]="t('terminalSettingsGeneralSettingsForm.tableRowHeight.medium')"
            [nzValue]="tableRowHeight.Medium"
          ></nz-option>
          <nz-option
            [nzLabel]="t('terminalSettingsGeneralSettingsForm.tableRowHeight.high')"
            [nzValue]="tableRowHeight.High"
          ></nz-option>
        </nz-select>
      </nz-form-control>
    </nz-form-item>
    <nz-form-item>
      <nz-form-label nzFor="userIdleDurationMin"
                     nzRequired>{{t('terminalSettingsGeneralSettingsForm.userIdleDurationLabel')}}</nz-form-label>
      <nz-form-control
        [nzErrorTip]="t(
                'terminalSettingsGeneralSettingsForm.intervalError',
                 {
                  min: validationSettings.userIdleDurationMin.min,
                  max: validationSettings.userIdleDurationMin.max
                 })"
      >
        <ats-input-number formControlName="userIdleDurationMin"></ats-input-number>
      </nz-form-control>
    </nz-form-item>

    <nz-form-item *ngIf="!excludedSettings.includes('badgesBind')">
      <label
        formControlName="badgesBind"
        nz-checkbox
      >
        {{t('terminalSettingsGeneralSettingsForm.badgesBindLabel')}}
        <span
          [nzPopoverTitle]="badgeBindHint"
          nz-icon
          nz-popover
          nzTheme="outline"
          nzType="info-circle">
              </span>
      </label>

      <ng-template #badgeBindHint>
        <p> {{t('terminalSettingsGeneralSettingsForm.badgesBindHint1')}} </p>
        <p>
          <nz-badge class="square-badge" nzColor="yellow"></nz-badge>
          - {{t('terminalSettingsGeneralSettingsForm.badgesBindHint2')}}
        </p>
        <p>
          <nz-badge nzColor="yellow"></nz-badge>
          - {{t('terminalSettingsGeneralSettingsForm.badgesBindHint3')}}
        </p>
      </ng-template>
    </nz-form-item>

    <button
      *ngIf="form.controls.badgesBind.value"
      nz-button
      nzType="primary"
      class="mb-10"
      (click)="addPredefinedLabels()"
      [disabled]="form.controls.badgesColors.value.length >= 20"
    >
      {{ t('terminalSettingsGeneralSettingsForm.addBadgesBtnLabel') }}
    </button>

    <nz-form-item *ngIf="form.controls.badgesBind.value">
      <nz-collapse [nzBordered]="false" nzGhost>
        <nz-collapse-panel [nzHeader]="t('terminalSettingsGeneralSettingsForm.badgesColorsHeaders')" nzActive="true">
          <div
            class="d-flex flex-wrap flex-gap-10"
            cdkDropListGroup
          >
            <div
              *ngFor="let badge of form.controls.badgesColors.value"
              class="position-relative"
              cdkDropList
              [cdkDropListData]="badge"
              (cdkDropListEntered)="changeBadgesOrder($event)">
              <div cdkDrag (cdkDragStarted)="badgeDragStarts($event)">
                <nz-color-block
                  [nzColor]="badge"
                ></nz-color-block>

                <button
                  *ngIf="badge !== defaultBadgeColor"
                  class="badge-btn remove-btn"
                  nz-button
                  nzSize="small"
                  (click)="removeBadgeColor($event, badge)"
                >
                  <i nz-icon nzType="close"></i>
                </button>
                <div *cdkDragPlaceholder></div>

              </div>
            </div>

            <nz-color-picker
              [nzFlipFlop]="newBadgeTrigger"
              [formControl]="newBadgeColorControl"
              [nzDisabledAlpha]="true"
              (nzOnOpenChange)="addNewBadgeColor($event)"
            ></nz-color-picker>

            <ng-template #newBadgeTrigger>
              <button nz-button class="badge-btn">
                <i nz-icon nzType="plus"></i>
              </button>
            </ng-template>
          </div>
        </nz-collapse-panel>
      </nz-collapse>
    </nz-form-item>

  </form>
</ng-container>
